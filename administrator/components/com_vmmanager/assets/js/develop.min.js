function saveDesign(){this.serialized_data=_.map(jQuery("#opc-design-content > .grid-stack-item:visible"),function(e){e=jQuery(e);var a=e.data("_gridstack_node");switch(parseInt(a.width)){case 1:var i="25%";break;case 2:var i="50%";break;case 3:var i="75%";break;default:var i="100%"}switch(parseInt(a.x)){case 1:var t="25%";break;case 2:var t="50%";break;case 3:var t="75%";break;default:var t="0%"}return{x:a.x,y:a.y,width:a.width,height:a.height,title:jQuery(e).text(),element:jQuery(e).attr("data-gs-element"),width_percent:i,margin:t,custom:jQuery(e).attr("data-gs-custom")}},this),jQuery("textarea[name=opc-design]").html(JSON.stringify(this.serialized_data,null,"    "))}function showPopupConfig(e){jQuery("body").find("#popupOverlay").remove(),jQuery("body").find("#popupConfig").remove(),jQuery("body").append('<div id="popupOverlay" style="display:none"></div>'),jQuery("body").append('<div id="popupConfig" class="loadingP" style="display:none"></div>');var a=jQuery("body").find("#popupConfig"),i=jQuery(window).height();i>320?a.css("height",i-100):(a.css("height",i-20),a.css("top",10));var t=jQuery(window).width();t>1170?a.css("left",(t-1150)/2):(a.css("left",5),a.css("width",t-10)),jQuery.ajax({url:"index.php?option=com_vmmanager&view=popup&popup=1&popupcf="+e,type:"GET",cache:false,success:function(e){jQuery("body").find("#popupConfig").removeClass("loadingP"),jQuery("body").find("#popupConfig").html(e),jQuery("body").find("#popupConfig").find("#popupItem").css("height",jQuery("body").find("#popupConfig").height()-48)}}),jQuery("html").css("overflow","hidden"),jQuery("body").find("#popupOverlay").fadeIn(300),a.fadeIn(500),jQuery(window).resize()}function closePopup(){jQuery("body").find("#popupOverlay").fadeOut(200).remove(),jQuery("body").find("#popupConfig").fadeOut(200).remove(),jQuery("html").css("overflow",""),jQuery(".colpick.colpick_full.colpick_dark").remove()}function openDialogMedia(e){jQuery(e).parent().find("input").addClass("media-textbox-value"),dir="components/com_vmmanager/helpers/media";var a=templateMedia(dir),i=jQuery(window).width(),t=jQuery(window).height();if(jQuery("body").append(a),t>320?(jQuery(".media-dialog").css("height",t-100),jQuery("#media-list-item").css("height",t-100-77-15),jQuery("#media-list").css("height",t-100-77),jQuery("#media-upload").css("height",t-100-77)):(jQuery(".media-dialog").css("height",t-20),jQuery(".media-dialog").css("top",10),jQuery("#media-list-item").css("height",t-20-77-15),jQuery("#media-list").css("height",t-20-77),jQuery("#media-upload").css("height",t-20-77)),i>1180){var n=(i-1170)/2;jQuery(".media-dialog").css({left:n,width:1170})}else{var s=i-10;jQuery(".media-dialog").css({left:5,width:s})}getImages(dir)}function templateMedia(){var e='<div class="media-overlay" onclick="closeDialogMedia()"></div><div class="media-dialog"><div class="media-dialog-header"><ul><li data-tab="#media-list" class="active rf-data">'+Joomla.JText._("OPC_POPUP_MEDIA_TITLE_MEDIA")+'</li><li data-tab="#media-upload" >'+Joomla.JText._("OPC_POPUP_MEDIA_TITLE_UPLOAD")+'</li></ul><span class="media-close-popup opc-iconcancel-1" onclick="closeDialogMedia()"></span></div><div class="media-dialog-content"><div id="media-list" class="active"><div class="media-info-file"></div><ul id="media-list-item"></ul></div><div id="media-upload" class=""><script src="components/com_vmmanager/assets/js/script.min.js"></script><form id="upload" method="post" action="index.php?option=com_vmmanager&task=uploadFile" enctype="multipart/form-data"><div id="drop"><p class="drop-text">'+Joomla.JText._("OPC_POPUP_MEDIA_UPLOAD_DROP_TEXT")+'</p><p class="or-text">'+Joomla.JText._("OPC_POPUP_MEDIA_UPLOAD_DROP_TEXT_OR")+"</p><a>"+Joomla.JText._("OPC_POPUP_MEDIA_UPLOAD_BROWSE")+'</a><p class="desc-maxfile">'+Joomla.JText._("OPC_POPUP_MEDIA_UPLOAD_MAXSIZE")+'</p><input type="file" name="upl_file" multiple /></div><ul class="media-queue"></ul></form></div></div></div>';return e}function closeDialogMedia(){jQuery(".media-overlay").remove(),jQuery(".media-dialog").remove(),jQuery("input.media-textbox-value").removeClass("media-textbox-value")}function getImages(e){jQuery("#media-list").children("ul").addClass("waitting"),jQuery.ajax({url:"index.php?option=com_vmmanager&task=getImages",type:"POST",data:{dir:e},dataType:"json",success:function(e){jQuery("#media-list").children("ul").removeClass("waitting"),jQuery("ul#media-list-item").html(getImagesHtml(e)),jQuery("ul#media-list-item").find("li.active_img > img").click()}})}function getImagesHtml(e){var a="",i=jQuery(".media-textbox-value").val(),t=" ";return jQuery.each(e,function(e,n){t=i==n.path?"active_img":"",a=a+'<li class="'+t+'"><img src="'+n.path+'" data-size="'+n.size+'" data-date="'+n.created+'" data-path="'+n.path+'" data-filesize="'+n.filesize+'" data-name="'+n.name+'" data-filetype="'+n.filetype+'"  data-dir="'+n.dir+'" class="media-show-info"/></li>'}),a}function getInfoFile(e){e=jQuery(e);var a="<h2>"+Joomla.JText._("OPC_POPUP_MEDIA_ATTACHMENT_DETAILS")+'</h2><div class="info"><div class="img"><img src="'+e.attr("src")+'"/><p class="name">'+e.attr("data-name")+'</p></div><div class="info-val"><p><span>'+Joomla.JText._("OPC_POPUP_MEDIA_FILESIZE")+"</span>"+e.attr("data-filesize")+"</p><p><span>"+Joomla.JText._("OPC_POPUP_MEDIA_CREATED")+"</span>"+e.attr("data-date")+"</p><p><span>"+Joomla.JText._("OPC_POPUP_MEDIA_FILESIZE")+"</span>"+e.attr("data-size")+"</p><p><span>"+Joomla.JText._("OPC_POPUP_MEDIA_FILETYPE")+"</span>"+e.attr("data-filetype")+'</p><div class="action"><span class="media-select-file" data-source="'+e.attr("data-path")+'">'+Joomla.JText._("OPC_POPUP_MEDIA_SELECT")+'</span><span class="media-delete-file" data-dir="'+e.attr("data-dir")+'">'+Joomla.JText._("OPC_POPUP_MEDIA_DELETE")+"</span></div>";return a}function showAlert(e){var a='<div class="overlay-alert"></div><div id="alert-popup"><h2>Are You Sure? <i class="opc-iconcancel-1" onclick="hideAlert()"></i></h2><div><p>Are you sure you want to delete this module?</p></div><div class="action-alert"><span class="alert-cancel">Cancel</span><span class="alert-ok" id="'+e+'">Delete</span></div>';jQuery(a).appendTo(jQuery("body"));var i=jQuery(window).width(),t=jQuery(window).height();jQuery("#alert-popup").css({left:(i-300)/2,display:"block",top:(t-225)/2})}function hideAlert(){jQuery(".overlay-alert").remove(),jQuery("#alert-popup").remove(),jQuery(".grid-stack-item").removeClass("remove-wait")}function refLifetime(){setInterval(function(){jQuery.ajax({url:"index.php?option=com_vmmanager&task=refUser",type:"GET",success:function(){console.log("Refresh session")}})},lifetime)}function checkMobile(){var e=!1;return function(a){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|ipad|tablet|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}!function($){function init_cache(){$cache={mainMenuElement:$("#main-menu"),menuLv1:$("#main-menu").find("li.tab-1"),reponsiveMenu:$(".reponsive-menu-cus"),breadcrumbsElement:$("#manager-breadcrumbs"),designContent:$("#opc-design-content")}}$(document).ready(function(){$("body > div.container-main").css("margin-top",$("body > nav.navbar").height()-35),checkMobile()&&$("body").addClass("mobile"),init_cache(),refLifetime(),$("#main-content").css("min-height",$(window).height()),$("#main-content-2").css("min-height",$(window).height()),$cache.menuLv1.click(function(){var e=$(this);if(!e.hasClass("active")){$cache.menuLv1.removeClass("active"),e.addClass("active");var a=e.attr("tabs");$cache.reponsiveMenu.find("a").removeClass("active"),$cache.reponsiveMenu.find("a[tabs = "+a+"]").addClass("active");var i=e.text(),t=$("#main-content").children(a).find("#main-mennu-2").find("li.tab-2.active").text();$cache.breadcrumbsElement.children(".breadcrumb-parent").html(i),$cache.breadcrumbsElement.children(".breadcrumb-child").html(t?t:""),$("#main-content").children().removeClass("active"),$("#main-content").children(a).addClass("active")}}),$cache.mainMenuElement.find(".sort-tabs").click(function(){var e=$(window).width(),a=$(this);if(e>768){var i=a.attr("data-active");"full"==i?($cache.mainMenuElement.css({width:"50px"}),$cache.mainMenuElement.find(".tab-1").find("span").css("display","none"),$("#manager-wapper").children("#main-content").css({"margin-left":"50px"}),a.attr("data-active","sort")):($cache.mainMenuElement.css({width:"180px"}),$cache.mainMenuElement.find(".tab-1").find("span").css("display",""),$("#manager-wapper").children("#main-content").css({"margin-left":"180px"}),a.attr("data-active","full"))}}),$(".extenPage").children("#main-mennu-2").find("li.tab-2").click(function(){var e=$(this);if(!e.hasClass("active")){var a=$(".extenPage").children("#main-mennu-2").find("li.tab-2");a.removeClass("active"),e.addClass("active");var i=e.attr("tabs");$cache.reponsiveMenu.find("a").removeClass("active"),$cache.reponsiveMenu.find("a[tab = "+i+"]").addClass("active");var t=e.text();$cache.breadcrumbsElement.children(".breadcrumb-child").html(t),$("#main-content-2").children().removeClass("active"),$("#main-content-2").children(i).addClass("active")}}),$cache.reponsiveMenu.find("a").click(function(){var e=$(this);if(!e.hasClass("active")){var a=e.attr("tabs"),i=e.attr("tab");if(a&&$cache.mainMenuElement.find("li.tab-1[tabs="+a+"]").click(),i){var t=e.attr("tabtmp");$cache.mainMenuElement.find("li.tab-1[tabs="+t+"]").click(),$(".extenPage").find("li.tab-2[tabs="+i+"]").click()}$cache.reponsiveMenu.find(".close-respon-menu").click()}}),$cache.reponsiveMenu.find(".close-respon-menu").click(function(){$(this).closest(".reponsive-menu-cus").width(0)}),$(".responsive-menu").click(function(){$cache.reponsiveMenu.width(320)});var buildLayout=$("textarea[name=opc-design]").val();buildLayout=eval("("+buildLayout+")"),$cache.designContent.gridstack({animate:!0,cell_height:80,vertical_margin:5});var items=GridStackUI.Utils.sort(buildLayout);_.each(items,function(e){var a='<div data-gs-element="'+e.element+'" data-gs-custom=""  ><div class="grid-stack-item-content">'+e.title+'</div><div/><i class="configElement opc-iconcog no-recycle" data-config="'+e.element+'" />';e.custom&&(a='<div data-gs-element="'+e.element+'" data-gs-custom="'+e.custom+'"><div class="grid-stack-item-content">'+e.title+'</div><div/><i class="configElement opc-iconcog" data-config="'+e.element+'" /><i class="recycleElement opc-iconcancel-1" data-recycle="'+e.custom+'" />'),$cache.designContent.data("gridstack").add_widget($(a),e.x,e.y,e.width,e.height)}),$(".queue-design .queue-item").draggable({appendTo:"body",helper:"clone"}),$cache.designContent.droppable({activeClass:"ui-state-default",hoverClass:"ui-state-hover",accept:":not(.ui-sortable-helper)",drop:function(e,a){if("opc-module"==a.draggable.attr("data")){var i=_.map($("#opc-design-content > .grid-stack-item:visible"),function(e){e=$(e);e.data("_gridstack_node");return $(e).attr("data-gs-element")}),t=a.draggable.attr("data-element");if(i.indexOf(t)>=0)return void alert("The module already exists");var n='<div data-gs-element="'+a.draggable.attr("data-element")+'" data-gs-custom="'+a.draggable.attr("data-custom")+'"><div class="grid-stack-item-content">'+a.draggable.attr("data-title")+'</div><div/><i class="configElement opc-iconcog" data-config="'+a.draggable.attr("data-element")+'" /><i class="recycleElement opc-iconcancel-1" data-recycle="'+a.draggable.attr("data-tmp")+'" />';$cache.designContent.data("gridstack").add_widget($(n),0,0,3,1,!0),saveDesign()}}}),$(document).on("click","i.recycleElement",function(){showAlert("ok-recycleElement"),$(this).parent().addClass("remove-wait")}),$(document).on("click","span#ok-recycleElement",function(){$cache.designContent.data("gridstack").remove_widget($(".grid-stack-item.remove-wait")),saveDesign(),hideAlert()}),$(document).on("click",".overlay-alert",function(){hideAlert()}),$(document).on("click","span.alert-cancel",function(){hideAlert()}),$cache.designContent.on("change",function(){saveDesign()}),$(document).on("click","i.configElement",function(){showPopupConfig($(this).attr("data-config"))}),$(document).on("click","div#popupOverlay",function(){closePopup()}),$(document).on("click","i.close-setting",function(){closePopup()}),$(document).on("click",".media-dialog-header li",function(){if(!$(this).hasClass("active")){$(".media-dialog-header").find(".active").removeClass("active"),$(this).addClass("active"),$(".media-dialog-content").find(".active").removeClass("active");var e=$(this).attr("data-tab");$(".media-dialog-content").find(e).addClass("active")}}),$(document).on("click",".media-show-info",function(){$("img.media-show-info").parent().removeClass("select_img"),$(this).parent().addClass("select_img"),$(".media-info-file").html(getInfoFile(this))}),$(document).on("click",".media-delete-file",function(){var e=$(this).attr("data-dir");$(".media-info-file").addClass("waitting"),jQuery.ajax({url:"index.php?option=com_vmmanager&task=deleteFile",type:"POST",data:{source:e},success:function(e){$(".media-info-file").removeClass("waitting"),"true"==e?($(".media-info-file").html(""),$(".rf-data").click()):alert("Can't delete file!!!")}})}),$(document).on("click",".media-select-file",function(){var e=$(this).attr("data-source");$(".media-textbox-value").val(e),closeDialogMedia()}),$(document).on("click",".rf-data",function(){getImages("components/com_vmmanager/helpers/media")}),$cache.breadcrumbsElement.find(".save-all").click(function(){if(!$(this).hasClass("saving")){$(this).addClass("saving"),$(".save-icon-pacman-parent.saved-opc").removeClass("saved-opc");var e={};e.opc=jQuery("form[name=opcExtension]").serializeFormJSON(),jQuery.ajax({url:"index.php?option=com_vmmanager&task=saveAllJson",type:"POST",data:e,success:function(){$cache.breadcrumbsElement.find(".save-all").removeClass("saving"),$(".save-icon-pacman-parent").addClass("saved-opc")}})}}),$(window).resize(function(){$("body > div.container-main").css("margin-top",$("body > nav.navbar").height()-35);var e=$(window).width(),a=$(window).height();if(a>320?($("body").find("#popupConfig").css("height",a-100),jQuery("body").find("#popupConfig").find("#popupItem").css("height",jQuery("body").find("#popupConfig").height()-48),$(".media-dialog").css("height",a-100),$("#media-list-item").css("height",a-100-77-15),$("#media-list").css("height",a-100-77),$("#media-upload").css("height",a-100-77)):($("body").find("#popupConfig").css("height",a-20),jQuery("body").find("#popupConfig").find("#popupItem").css("height",jQuery("body").find("#popupConfig").height()-48),$("body").find("#popupConfig").css("top",10),$(".media-dialog").css("height",a-20),$(".media-dialog").css("top",10),$("#media-list-item").css("height",a-20-77-15),$("#media-list").css("height",a-20-77),$("#media-upload").css("height",a-20-77)),e>1180){var i=(e-1170-10)/2;$(".media-dialog").css({left:i,width:1170}),$("body").find("#popupConfig").css("left",(e-1150)/2),$("body").find("#popupConfig").css("width",1150)}else{var t=e-10;$(".media-dialog").css({left:0,width:t}),$("body").find("#popupConfig").css("left",5),$("body").find("#popupConfig").css("width",e-10)}}),$.fn.serializeFormJSON=function(){var e={},a=this.serializeArray();return $.each(a,function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e}})}(jQuery);